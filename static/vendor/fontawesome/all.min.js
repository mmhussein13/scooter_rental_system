/**
 * Simplified local Font Awesome replacement
 * This is a minimal implementation to ensure basic icon functionality
 * works even when offline
 */

// Define basic icon replacements for offline use
const fontAwesomeReplacements = {
  // Standard UI icons
  'fa-plus': '+',
  'fa-edit': 'âœŽ',
  'fa-trash': 'ðŸ—‘',
  'fa-eye': 'ðŸ‘',
  'fa-search': 'ðŸ”',
  'fa-print': 'ðŸ–¨',
  'fa-file-excel': 'ðŸ“Š',
  'fa-file-pdf': 'ðŸ“„',
  'fa-save': 'ðŸ’¾',
  'fa-arrow-left': 'â†',
  'fa-arrow-right': 'â†’',
  'fa-arrow-up': 'â†‘',
  'fa-arrow-down': 'â†“',
  'fa-check': 'âœ“',
  'fa-times': 'âœ—',
  'fa-cog': 'âš™',
  'fa-gear': 'âš™',
  'fa-warning': 'âš ',
  'fa-exclamation-triangle': 'âš ',
  'fa-bell': 'ðŸ””',
  'fa-user': 'ðŸ‘¤',
  'fa-users': 'ðŸ‘¥',
  'fa-envelope': 'âœ‰',
  'fa-lock': 'ðŸ”’',
  'fa-unlock': 'ðŸ”“',
  'fa-calendar': 'ðŸ“…',
  'fa-clock': 'ðŸ•’',
  'fa-home': 'ðŸ ',
  'fa-star': 'â˜…',
  
  // Domain-specific icons
  'fa-wrench': 'ðŸ”§',
  'fa-tools': 'ðŸ”§',
  'fa-car': 'ðŸš—',
  'fa-motorcycle': 'ðŸ›µ',
  'fa-warehouse': 'ðŸ­',
  'fa-truck': 'ðŸšš',
  'fa-box': 'ðŸ“¦',
  'fa-boxes': 'ðŸ“¦ðŸ“¦',
  'fa-money-bill': 'ðŸ’µ',
  'fa-credit-card': 'ðŸ’³',
  'fa-chart-line': 'ðŸ“ˆ',
  'fa-chart-bar': 'ðŸ“Š',
  'fa-tachometer-alt': 'ðŸŽï¸',
  'fa-gauge': 'ðŸŽï¸',
  'fa-clipboard': 'ðŸ“‹',
  'fa-clipboard-list': 'ðŸ“‹',
  'fa-clipboard-check': 'ðŸ“‹âœ“',
  'fa-tasks': 'ðŸ“‹',
  'fa-shopping-cart': 'ðŸ›’',
  'fa-truck-loading': 'ðŸ“¦',
  'fa-dolly': 'ðŸ“¦',
  'fa-barcode': 'ðŸ“Š',
  'fa-qrcode': 'ðŸ“Š',
};

// Apply the replacements to the DOM when needed
function applyFontAwesomeReplacements() {
  // Only apply replacements when offline or icons not loading
  if (navigator.onLine && typeof FontAwesome !== 'undefined') {
    return;
  }
  
  // Find all Font Awesome icons
  const allIcons = document.querySelectorAll('.fas, .far, .fab, .fa');
  
  // Replace each icon with the appropriate fallback
  allIcons.forEach(icon => {
    // Skip if already processed
    if (icon.dataset.faProcessed) return;
    
    // Check all classes to find which icon this is
    let iconType = '';
    icon.classList.forEach(cls => {
      if (cls.startsWith('fa-')) {
        iconType = cls;
      }
    });
    
    // Skip if we didn't find a matching icon type
    if (!iconType || !fontAwesomeReplacements[iconType]) return;
    
    // Mark as processed
    icon.dataset.faProcessed = true;
    
    // Preserve original styling
    const originalColor = window.getComputedStyle(icon).color;
    const originalBg = window.getComputedStyle(icon).backgroundColor;
    
    // Replace with text fallback
    icon.innerHTML = fontAwesomeReplacements[iconType];
    
    // Apply original styling
    icon.style.color = originalColor;
    icon.style.backgroundColor = originalBg;
  });
}

// Run on page load
document.addEventListener('DOMContentLoaded', () => {
  // Try to load Font Awesome if online
  if (navigator.onLine) {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js';
    script.integrity = 'sha512-fzff82+8pzHnwA1mQ0dzz9/E0B+ZRizq08yZY3vmcuQsrI1W8sq6G5L0ZI2qDzVfxW0MGbcLKlZ18E/d6eozQw==';
    script.crossOrigin = 'anonymous';
    script.referrerPolicy = 'no-referrer';
    script.onerror = applyFontAwesomeReplacements;
    document.body.appendChild(script);
  } else {
    // Offline - use replacements
    applyFontAwesomeReplacements();
  }
  
  // Also run fallbacks after a short delay to catch any missed icons
  setTimeout(applyFontAwesomeReplacements, 1000);
});
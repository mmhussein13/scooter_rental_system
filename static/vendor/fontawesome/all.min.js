/**
 * Simplified local Font Awesome replacement
 * This is a minimal implementation to ensure basic icon functionality
 * works even when offline
 */

// Define basic icon replacements for offline use
const fontAwesomeReplacements = {
  // Standard UI icons
  'fa-plus': '+',
  'fa-edit': '✎',
  'fa-trash': '🗑',
  'fa-eye': '👁',
  'fa-search': '🔍',
  'fa-print': '🖨',
  'fa-file-excel': '📊',
  'fa-file-pdf': '📄',
  'fa-save': '💾',
  'fa-arrow-left': '←',
  'fa-arrow-right': '→',
  'fa-arrow-up': '↑',
  'fa-arrow-down': '↓',
  'fa-check': '✓',
  'fa-times': '✗',
  'fa-cog': '⚙',
  'fa-gear': '⚙',
  'fa-warning': '⚠',
  'fa-exclamation-triangle': '⚠',
  'fa-bell': '🔔',
  'fa-user': '👤',
  'fa-users': '👥',
  'fa-envelope': '✉',
  'fa-lock': '🔒',
  'fa-unlock': '🔓',
  'fa-calendar': '📅',
  'fa-clock': '🕒',
  'fa-home': '🏠',
  'fa-star': '★',
  
  // Domain-specific icons
  'fa-wrench': '🔧',
  'fa-tools': '🔧',
  'fa-car': '🚗',
  'fa-motorcycle': '🛵',
  'fa-warehouse': '🏭',
  'fa-truck': '🚚',
  'fa-box': '📦',
  'fa-boxes': '📦📦',
  'fa-money-bill': '💵',
  'fa-credit-card': '💳',
  'fa-chart-line': '📈',
  'fa-chart-bar': '📊',
  'fa-tachometer-alt': '🏎️',
  'fa-gauge': '🏎️',
  'fa-clipboard': '📋',
  'fa-clipboard-list': '📋',
  'fa-clipboard-check': '📋✓',
  'fa-tasks': '📋',
  'fa-shopping-cart': '🛒',
  'fa-truck-loading': '📦',
  'fa-dolly': '📦',
  'fa-barcode': '📊',
  'fa-qrcode': '📊',
};

// Apply the replacements to the DOM when needed
function applyFontAwesomeReplacements() {
  // Only apply replacements when offline or icons not loading
  if (navigator.onLine && typeof FontAwesome !== 'undefined') {
    return;
  }
  
  // Find all Font Awesome icons
  const allIcons = document.querySelectorAll('.fas, .far, .fab, .fa');
  
  // Replace each icon with the appropriate fallback
  allIcons.forEach(icon => {
    // Skip if already processed
    if (icon.dataset.faProcessed) return;
    
    // Check all classes to find which icon this is
    let iconType = '';
    icon.classList.forEach(cls => {
      if (cls.startsWith('fa-')) {
        iconType = cls;
      }
    });
    
    // Skip if we didn't find a matching icon type
    if (!iconType || !fontAwesomeReplacements[iconType]) return;
    
    // Mark as processed
    icon.dataset.faProcessed = true;
    
    // Preserve original styling
    const originalColor = window.getComputedStyle(icon).color;
    const originalBg = window.getComputedStyle(icon).backgroundColor;
    
    // Replace with text fallback
    icon.innerHTML = fontAwesomeReplacements[iconType];
    
    // Apply original styling
    icon.style.color = originalColor;
    icon.style.backgroundColor = originalBg;
  });
}

// Run on page load
document.addEventListener('DOMContentLoaded', () => {
  // Try to load Font Awesome if online
  if (navigator.onLine) {
    const script = document.createElement('script');
    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js';
    script.integrity = 'sha512-fzff82+8pzHnwA1mQ0dzz9/E0B+ZRizq08yZY3vmcuQsrI1W8sq6G5L0ZI2qDzVfxW0MGbcLKlZ18E/d6eozQw==';
    script.crossOrigin = 'anonymous';
    script.referrerPolicy = 'no-referrer';
    script.onerror = applyFontAwesomeReplacements;
    document.body.appendChild(script);
  } else {
    // Offline - use replacements
    applyFontAwesomeReplacements();
  }
  
  // Also run fallbacks after a short delay to catch any missed icons
  setTimeout(applyFontAwesomeReplacements, 1000);
});